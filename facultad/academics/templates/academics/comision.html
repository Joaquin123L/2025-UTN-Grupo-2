{% extends "base.html" %}
{% block title %}Departamentos - Pasa la Data{% endblock %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'academics/css/departamento.css' %}">
{% endblock %}


{% block content %}
<div class="aa-container">
  <div class="aa-toolbar">
    <div class="aa-titles">
  <h2 class="aa-h2">Comisiones:</h2>
  <h2 class="aa-subh2">{{ materia.nombre }}</h2>
</div>

    <div class="aa-filter">
<select id="year">
  {% for y in year_choices %}
    <option value="{{ y }}" {% if y == current_year %}selected{% endif %}>{{ y }}</option>
  {% endfor %}
</select>

</div>
    <div class="aa-search">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path
          d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 0 0 1.57-4.23C15.99 6.01 13.48 3.5 10.5 3.5S5 6.01 5 9s2.51 5.5 5.5 5.5c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l4.25 4.25 1.27-1.27L15.5 14Zm-5 0C8.01 14 6 11.99 6 9.5S8.01 5 10.5 5 15 7.01 15 9.5 12.99 14 10.5 14Z" />
      </svg>
      <input id="search" type="text" placeholder="Buscar" autocomplete="off">
    </div>
  </div>

 <section id="grid" class="aa-grid">
  {% for mca, rating in mca_with_rating %}
    {% url 'academics:perfil_comision' materia.id mca.comision.id current_year as comision_url %}

     {% if mca.comision.profesor %}{{ mca.comision.profesor.last_name }}, {{ mca.comision.profesor.first_name }}{% endif %}
     

    {% if mca.titular %}{% url 'academics:perfil_profesor' mca.titular.username as titular_url %}{% endif %}
    {% if mca.jtp %}{% url 'academics:perfil_profesor' mca.jtp.username as jtp_url %}{% endif %}

    {# --- nombres seguros para titular y jtp --- #}
    {% if mca.titular %}
      {% with titular_name=mca.titular.first_name|add:" "|add:mca.titular.last_name %}
        {% if mca.jtp %}
          {% with jtp_name=mca.jtp.first_name|add:" "|add:mca.jtp.last_name %}
            {% include "academics/Components/card.html" with title=mca.comision.nombre image_url=mca.comision.imagen icon=mca.comision.icono badge=mca.comision.badge rating=rating titular=titular_name jtp=jtp_name titular_url=titular_url|default_if_none:"" jtp_url=jtp_url|default_if_none:"" href=comision_url %}
          {% endwith %}
        {% else %}
          {% include "academics/Components/card.html" with title=mca.comision.nombre image_url=mca.comision.imagen icon=mca.comision.icono badge=mca.comision.badge rating=rating titular=titular_name jtp="A confirmar" titular_url=titular_url|default_if_none:"" jtp_url="" href=comision_url %}
        {% endif %}
      {% endwith %}
    {% else %}
      {% if mca.jtp %}
        {% with jtp_name=mca.jtp.first_name|add:" "|add:mca.jtp.last_name %}
          {% include "academics/Components/card.html" with title=mca.comision.nombre image_url=mca.comision.imagen icon=mca.comision.icono badge=mca.comision.badge rating=rating titular="A confirmar" jtp=jtp_name titular_url="" jtp_url=jtp_url|default_if_none:"" href=comision_url %}
        {% endwith %}
      {% else %}
        {% include "academics/Components/card.html" with title=mca.comision.nombre image_url=mca.comision.imagen icon=mca.comision.icono badge=mca.comision.badge rating=rating titular="A confirmar" jtp="A confirmar" titular_url="" jtp_url="" href=comision_url %}
      {% endif %}
    {% endif %}
  {% endfor %}
</section>

</div>

<script>
  const input = document.getElementById('search');
  const cards = Array.from(document.querySelectorAll('.aa-card'));
  input.addEventListener('input', (e) => {
    const q = e.target.value.trim().toLowerCase();
    cards.forEach(c => c.style.display = c.dataset.name.includes(q) ? '' : 'none');
  });
</script> 
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const sel = document.getElementById('year');
    if (!sel) return;

    sel.addEventListener('change', () => {
      const y = sel.value;
      const tpl = "{% url 'academics:materia_comisiones' materia.id current_year %}";
      const nextUrl = tpl.replace(/\/\d+\/comisiones\/$/, `/${y}/comisiones/`);
      window.location.href = nextUrl;
    });
  });
</script>
<script>
  document.addEventListener('click', (e) => {
    const card = e.target.closest('.aa-card');
    if (!card) return;
    if (e.target.closest('a')) return; 
    const url = card.dataset.href;
    if (url) window.location.href = url;
  });
</script>






{% endblock %}